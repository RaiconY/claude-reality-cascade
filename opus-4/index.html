<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каскад Реальности - Opus 4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .model-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(139, 69, 19, 0.9);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 1000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            margin-top: 40px;
        }

        .header h1 {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.25rem;
            color: #a78bfa;
            margin-bottom: 20px;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .choice-card {
            position: relative;
            background: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 20px;
            padding: 24px;
            cursor: pointer;
            transition: all 300ms ease;
            overflow: hidden;
            group: true;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 300ms ease;
            border-radius: 20px;
        }

        .choice-card:hover::before {
            opacity: 0.2;
        }

        .choice-card:hover {
            transform: scale(1.05);
            border-color: #8b5cf6;
        }

        .choice-card[data-color="blue"]::before {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }
        .choice-card[data-color="yellow"]::before {
            background: linear-gradient(135deg, #eab308, #ea580c);
        }
        .choice-card[data-color="purple"]::before {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
        }
        .choice-card[data-color="cyan"]::before {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
        }
        .choice-card[data-color="red"]::before {
            background: linear-gradient(135deg, #ef4444, #ec4899);
        }
        .choice-card[data-color="teal"]::before {
            background: linear-gradient(135deg, #14b8a6, #06b6d4);
        }
        .choice-card[data-color="green"]::before {
            background: linear-gradient(135deg, #22c55e, #84cc16);
        }
        .choice-card[data-color="indigo"]::before {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }
        .choice-card[data-color="gray"]::before {
            background: linear-gradient(135deg, #6b7280, #64748b);
        }
        .choice-card[data-color="amber"]::before {
            background: linear-gradient(135deg, #f59e0b, #eab308);
        }

        .card-content {
            position: relative;
            z-index: 10;
        }

        .icon-container {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .icon-container[data-color="blue"] {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }
        .icon-container[data-color="yellow"] {
            background: linear-gradient(135deg, #eab308, #ea580c);
        }
        .icon-container[data-color="purple"] {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
        }
        .icon-container[data-color="cyan"] {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
        }
        .icon-container[data-color="red"] {
            background: linear-gradient(135deg, #ef4444, #ec4899);
        }
        .icon-container[data-color="teal"] {
            background: linear-gradient(135deg, #14b8a6, #06b6d4);
        }
        .icon-container[data-color="green"] {
            background: linear-gradient(135deg, #22c55e, #84cc16);
        }
        .icon-container[data-color="indigo"] {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }
        .icon-container[data-color="gray"] {
            background: linear-gradient(135deg, #6b7280, #64748b);
        }
        .icon-container[data-color="amber"] {
            background: linear-gradient(135deg, #f59e0b, #eab308);
        }

        .choice-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
        }

        .choice-desc {
            color: #9ca3af;
        }

        .arrow-icon {
            position: absolute;
            bottom: 16px;
            right: 16px;
            opacity: 0;
            transition: opacity 300ms ease;
            color: #8b5cf6;
        }

        .choice-card:hover .arrow-icon {
            opacity: 1;
        }

        /* Story View */
        .story-view {
            display: none;
        }

        .story-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .back-button {
            color: #a78bfa;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 32px;
            transition: color 200ms ease;
        }

        .back-button:hover {
            color: white;
        }

        .story-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .story-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }

        .story-subtitle {
            color: #a78bfa;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .progress-step {
            flex: 1;
            height: 8px;
            margin: 0 4px;
            border-radius: 9999px;
            transition: all 500ms ease;
            background: #374151;
        }

        .progress-step.active {
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .story-content {
            background: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            transform: scale(1);
            opacity: 1;
            transition: all 500ms ease;
        }

        .level-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            margin-bottom: 16px;
        }

        .story-description {
            font-size: 1.25rem;
            color: white;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .effects-list {
            list-style: none;
            padding: 0;
        }

        .effect-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 500ms ease forwards;
        }

        .effect-item:nth-child(1) { animation-delay: 0ms; }
        .effect-item:nth-child(2) { animation-delay: 200ms; }
        .effect-item:nth-child(3) { animation-delay: 400ms; }

        .effect-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .effect-text {
            color: #d1d5db;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            transition: all 200ms ease;
            border: none;
            cursor: pointer;
        }

        .nav-button:disabled {
            background: #1f2937;
            color: #6b7280;
            cursor: not-allowed;
        }

        .nav-button:not(:disabled) {
            background: #1f2937;
            color: white;
        }

        .nav-button:not(:disabled):hover {
            background: #374151;
        }

        .nav-button.primary:not(:disabled) {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-button.primary:not(:disabled):hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step-counter {
            color: #a78bfa;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .choices-grid {
                grid-template-columns: 1fr;
            }
            
            .story-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="model-badge">
        🧠 Claude Opus 4
    </div>

    <div class="container">
        <!-- Main Menu -->
        <div id="main-menu">
            <div class="header">
                <h1>Каскад Реальности</h1>
                <p class="subtitle">Выберите одно изменение и проследите цепочку последствий</p>
            </div>

            <div class="choices-grid" id="choices-grid">
                <!-- Choices will be generated here -->
            </div>
        </div>

        <!-- Story View -->
        <div id="story-view" class="story-view">
            <div>
                <a href="#" class="back-button" onclick="resetGame()">
                    ← Вернуться к выбору
                </a>
            </div>

            <div class="story-header">
                <div id="story-icon" class="story-icon"></div>
                <h1 id="story-title" class="story-title"></h1>
                <p id="story-subtitle" class="story-subtitle"></p>
            </div>

            <div>
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="story-content" class="story-content">
                <!-- Content will be generated here -->
            </div>

            <div class="navigation">
                <button id="prev-btn" class="nav-button" onclick="prevStep()">Назад</button>
                <span id="step-counter" class="step-counter"></span>
                <button id="next-btn" class="nav-button primary" onclick="nextStep()">Далее</button>
            </div>
        </div>
    </div>

    <script>
        const changes = [
            {
                id: 1,
                icon: "🌍",
                title: "Гравитация слабее на 50%",
                description: "Сила притяжения уменьшилась вдвое",
                color: "blue"
            },
            {
                id: 2,
                icon: "⚡",
                title: "Скорость света в 10 раз медленнее",
                description: "Фундаментальная константа изменена",
                color: "yellow"
            },
            {
                id: 3,
                icon: "🕐",
                title: "Люди не нуждаются во сне",
                description: "Организм восстанавливается без отдыха",
                color: "purple"
            },
            {
                id: 4,
                icon: "🧠",
                title: "Телепатия у всех людей",
                description: "Мысли передаются напрямую",
                color: "cyan"
            },
            {
                id: 5,
                icon: "❤️",
                title: "Люди не стареют после 25 лет",
                description: "Биологическое бессмертие",
                color: "red"
            },
            {
                id: 6,
                icon: "⚛️",
                title: "Вода тяжелее воздуха",
                description: "Плотности веществ изменились",
                color: "teal"
            },
            {
                id: 7,
                icon: "☀️",
                title: "Фотосинтез у людей",
                description: "Люди получают энергию от солнца",
                color: "green"
            },
            {
                id: 8,
                icon: "🌙",
                title: "Сутки длятся 48 часов",
                description: "Земля вращается в два раза медленнее",
                color: "indigo"
            },
            {
                id: 9,
                icon: "💨",
                title: "Воздух в 5 раз плотнее",
                description: "Атмосферное давление увеличено",
                color: "gray"
            },
            {
                id: 10,
                icon: "✨",
                title: "Металлы стали пластичными как глина",
                description: "Структура металлов изменилась",
                color: "amber"
            }
        ];

        const consequences = {
            1: [
                {
                    level: "Фундаментальный сдвиг",
                    description: "Гравитационная постоянная уменьшилась вдвое. Все объекты во Вселенной испытывают меньшее притяжение друг к другу.",
                    effects: ["Орбиты планет расширяются", "Звёзды горят медленнее", "Галактики становятся более рассеянными"]
                },
                {
                    level: "Планетарные изменения",
                    description: "Атмосфера Земли расширяется и становится менее плотной. Океаны испытывают меньшее давление.",
                    effects: ["Уровень моря поднимается на 20%", "Атмосферное давление падает", "Облака формируются выше"]
                },
                {
                    level: "Биологическая эволюция",
                    description: "Живые организмы адаптируются к новым условиям. Появляются гигантские формы жизни.",
                    effects: ["Деревья вырастают до 500 метров", "Птицы летают выше и дольше", "Морские существа становятся крупнее"]
                },
                {
                    level: "Человеческая цивилизация",
                    description: "Архитектура кардинально меняется. Транспорт становится воздушным.",
                    effects: ["Небоскрёбы достигают 3 км", "Прыжки до 10 метров в высоту", "Летающие города становятся реальностью"]
                }
            ],
            2: [
                {
                    level: "Фундаментальный сдвиг",
                    description: "Скорость света теперь 30,000 км/с. Вся физика электромагнетизма изменилась.",
                    effects: ["Время и пространство искажаются", "Энергия связи атомов ослабевает", "Квантовые эффекты усиливаются"]
                },
                {
                    level: "Космические масштабы",
                    description: "Звёзды светят тусклее. Расстояния во Вселенной кажутся больше.",
                    effects: ["Солнце даёт в 100 раз меньше энергии", "Связь с другими звёздами невозможна", "Вселенная кажется пустой"]
                },
                {
                    level: "Технологический коллапс",
                    description: "Электроника работает медленнее. Компьютеры становятся неэффективными.",
                    effects: ["Интернет работает с огромными задержками", "GPS не функционирует", "Радиосвязь ограничена"]
                },
                {
                    level: "Новая реальность",
                    description: "Человечество возвращается к локальным сообществам. Развивается новая наука.",
                    effects: ["Города становятся автономными", "Квантовые технологии заменяют электронику", "Телепортация становится возможной"]
                }
            ],
            3: [
                {
                    level: "Биологическая революция",
                    description: "Человеческий мозг перестраивается для постоянной активности. Метаболизм ускоряется.",
                    effects: ["Нейроны регенерируют быстрее", "Память улучшается в 10 раз", "Старение замедляется"]
                },
                {
                    level: "Социальная трансформация",
                    description: "24-часовая активность меняет общество. Понятие ночи исчезает.",
                    effects: ["Продуктивность растёт в 3 раза", "Города никогда не спят", "Культура сна исчезает"]
                },
                {
                    level: "Экономический бум",
                    description: "Дополнительные 8 часов в день революционизируют экономику.",
                    effects: ["ВВП удваивается за 5 лет", "Наука развивается в 5 раз быстрее", "Колонизация космоса ускоряется"]
                },
                {
                    level: "Психологическая эволюция",
                    description: "Человеческое сознание расширяется. Появляются новые формы искусства.",
                    effects: ["Медитация заменяет сон", "Творчество непрерывно", "Коллективное сознание развивается"]
                }
            ],
            4: [
                {
                    level: "Ментальная революция",
                    description: "Все мысли становятся доступными. Приватность исчезает как концепция.",
                    effects: ["Ложь становится невозможной", "Эмпатия достигает максимума", "Индивидуальность переосмысливается"]
                },
                {
                    level: "Социальный коллапс и перерождение",
                    description: "Старые структуры власти рушатся. Формируется новое общество.",
                    effects: ["Правительства становятся прозрачными", "Преступность исчезает", "Коллективные решения мгновенны"]
                },
                {
                    level: "Эволюция коммуникации",
                    description: "Язык становится устаревшим. Мысли передаются напрямую.",
                    effects: ["Обучение ускоряется в 100 раз", "Искусство становится ментальным", "Наука развивается экспоненциально"]
                },
                {
                    level: "Новое человечество",
                    description: "Формируется коллективный разум. Индивидуальность сливается с общим.",
                    effects: ["Решения принимаются мгновенно", "Конфликты исчезают", "Человечество действует как единый организм"]
                }
            ],
            5: [
                {
                    level: "Биологическая остановка времени",
                    description: "Теломеры перестают укорачиваться. Клетки регенерируют бесконечно.",
                    effects: ["Болезни старения исчезают", "Физический пик сохраняется", "Мозг остаётся молодым"]
                },
                {
                    level: "Демографический взрыв",
                    description: "Смертность падает до минимума. Население растёт экспоненциально.",
                    effects: ["Население достигает 50 млрд", "Ресурсы становятся критичными", "Жизненное пространство ограничено"]
                },
                {
                    level: "Социальная стратификация",
                    description: "Формируются касты по возрасту. Опыт становится главной валютой.",
                    effects: ["500-летние правят миром", "Молодые борются за ресурсы", "Знания накапливаются веками"]
                },
                {
                    level: "Космическая экспансия",
                    description: "Человечество вынуждено колонизировать космос. Время теряет значение.",
                    effects: ["Межзвёздные путешествия нормальны", "Поколения не сменяются", "Цивилизация становится вечной"]
                }
            ],
            6: [
                {
                    level: "Физический парадокс",
                    description: "Вода опускается под воздух. Океаны уходят вглубь планеты.",
                    effects: ["Атмосфера заполняет океанские впадины", "Вода формирует подземный слой", "Давление в недрах растёт"]
                },
                {
                    level: "Геологическая катастрофа",
                    description: "Тектонические плиты разрушаются. Вулканы извергаются повсеместно.",
                    effects: ["Континенты трескаются", "Новые горы формируются", "Землетрясения непрерывны"]
                },
                {
                    level: "Биосферный коллапс",
                    description: "Морская жизнь вымирает. Наземные организмы эволюционируют.",
                    effects: ["Рыбы развивают лёгкие", "Растения уходят под землю", "Новые формы жизни в воздухе"]
                },
                {
                    level: "Подземная цивилизация",
                    description: "Человечество строит города в пещерах у воды. Поверхность становится пустыней.",
                    effects: ["Вертикальные города в скалах", "Гидропоника под землёй", "Новая подземная экосистема"]
                }
            ],
            7: [
                {
                    level: "Метаболическая революция",
                    description: "Человеческая кожа развивает хлоропласты. Питание от солнца становится возможным.",
                    effects: ["Зелёный оттенок кожи", "Потребность в пище падает на 80%", "Энергия от фотосинтеза"]
                },
                {
                    level: "Конец голода",
                    description: "Продовольственная проблема решена. Сельское хозяйство трансформируется.",
                    effects: ["Фермы становятся парками", "Животноводство исчезает", "Леса восстанавливаются"]
                },
                {
                    level: "Социальная реструктуризация",
                    description: "Работа и досуг меняются. Солнечные часы определяют активность.",
                    effects: ["Рабочий день следует за солнцем", "Миграции к экватору", "Ночные города вымирают"]
                },
                {
                    level: "Эволюция культуры",
                    description: "Поклонение солнцу возрождается. Архитектура максимизирует свет.",
                    effects: ["Стеклянные города", "Солнечные фестивали", "Новая эстетика прозрачности"]
                }
            ],
            8: [
                {
                    level: "Орбитальная механика",
                    description: "Земля замедлила вращение. День и ночь длятся по 24 часа.",
                    effects: ["Температурные экстремумы", "Ветры достигают 500 км/ч", "Магнитное поле ослабевает"]
                },
                {
                    level: "Климатический хаос",
                    description: "Дневная сторона перегревается, ночная замерзает. Погода становится экстремальной.",
                    effects: ["Температура днём +80°C", "Ночью -60°C", "Ураганы на границе дня и ночи"]
                },
                {
                    level: "Биологическая адаптация",
                    description: "Жизнь мигрирует в сумеречные зоны. Новые циклы активности.",
                    effects: ["48-часовые биоритмы", "Миграционное поведение", "Подземные убежища"]
                },
                {
                    level: "Кочевая цивилизация",
                    description: "Города на колёсах следуют за терминатором. Статичные поселения невозможны.",
                    effects: ["Мобильные мегаполисы", "Энергия от перепада температур", "Культура вечного движения"]
                }
            ],
            9: [
                {
                    level: "Атмосферное давление",
                    description: "Давление воздуха увеличилось в 5 раз. Дыхание требует усилий.",
                    effects: ["Лёгкие адаптируются", "Движение замедляется", "Звук распространяется иначе"]
                },
                {
                    level: "Аэродинамический мир",
                    description: "Полёт становится проще. Ветер обретает разрушительную силу.",
                    effects: ["Птицы летают медленнее", "Планеры эффективнее", "Штормы опустошительны"]
                },
                {
                    level: "Технологическая адаптация",
                    description: "Транспорт переосмысливается. Здания становятся обтекаемыми.",
                    effects: ["Дирижабли доминируют", "Аэродинамическая архитектура", "Подводные города"]
                },
                {
                    level: "Эволюция общества",
                    description: "Жизнь замедляется. Культура адаптируется к плотной атмосфере.",
                    effects: ["Медленные движения в моде", "Громкая речь необходима", "Новые виды спорта"]
                }
            ],
            10: [
                {
                    level: "Материаловедческая революция",
                    description: "Кристаллическая решётка металлов стала аморфной. Металлы текут при комнатной температуре.",
                    effects: ["Сталь как пластилин", "Золото течёт как мёд", "Алюминий формуется руками"]
                },
                {
                    level: "Технологический переворот",
                    description: "Вся инфраструктура рушится. Новые технологии на основе керамики и полимеров.",
                    effects: ["Мосты провисают", "Машины деформируются", "Электроника перестаёт работать"]
                },
                {
                    level: "Архитектурное возрождение",
                    description: "Органические формы доминируют. Здания растут, а не строятся.",
                    effects: ["Живые металлические структуры", "Самовосстанавливающиеся дома", "Текучая архитектура"]
                },
                {
                    level: "Новое искусство",
                    description: "Скульптура становится динамичной. Металл как новая форма живописи.",
                    effects: ["Живые статуи", "Металлическая анимация", "Интерактивное искусство"]
                }
            ]
        };

        let selectedChange = null;
        let currentStep = 0;
        let isAnimating = false;

        function initGame() {
            const grid = document.getElementById('choices-grid');
            grid.innerHTML = '';
            
            changes.forEach(change => {
                const card = document.createElement('div');
                card.className = 'choice-card';
                card.setAttribute('data-color', change.color);
                card.onclick = () => handleSelectChange(change);
                
                card.innerHTML = `
                    <div class="card-content">
                        <div class="icon-container" data-color="${change.color}">
                            <span style="font-size: 24px;">${change.icon}</span>
                        </div>
                        <h3 class="choice-title">${change.title}</h3>
                        <p class="choice-desc">${change.description}</p>
                    </div>
                    <div class="arrow-icon">→</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function handleSelectChange(change) {
            selectedChange = change;
            currentStep = 0;
            setIsAnimating(true);
            showStoryView();
        }

        function showStoryView() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('story-view').style.display = 'block';
            
            // Set header
            const iconEl = document.getElementById('story-icon');
            iconEl.className = `story-icon`;
            iconEl.setAttribute('data-color', selectedChange.color);
            iconEl.style.background = getGradientForColor(selectedChange.color);
            iconEl.innerHTML = `<span style="font-size: 32px;">${selectedChange.icon}</span>`;
            
            document.getElementById('story-title').textContent = selectedChange.title;
            document.getElementById('story-subtitle').textContent = selectedChange.description;
            
            // Create progress bar
            const progressBar = document.getElementById('progress-bar');
            progressBar.innerHTML = '';
            const stepsCount = consequences[selectedChange.id].length;
            
            for (let i = 0; i < stepsCount; i++) {
                const step = document.createElement('div');
                step.className = `progress-step ${i <= currentStep ? 'active' : ''}`;
                progressBar.appendChild(step);
            }
            
            updateStoryContent();
            updateNavigation();
        }

        function updateStoryContent() {
            const content = document.getElementById('story-content');
            const currentConsequence = consequences[selectedChange.id][currentStep];
            
            content.innerHTML = `
                <span class="level-badge" style="background: ${getGradientForColor(selectedChange.color)}">
                    Уровень ${currentStep + 1}: ${currentConsequence.level}
                </span>
                
                <p class="story-description">
                    ${currentConsequence.description}
                </p>
                
                <ul class="effects-list">
                    ${currentConsequence.effects.map(effect => `
                        <li class="effect-item">
                            <div class="effect-dot" style="background: ${getGradientForColor(selectedChange.color)}"></div>
                            <p class="effect-text">${effect}</p>
                        </li>
                    `).join('')}
                </ul>
            `;
            
            updateProgressBar();
        }

        function updateProgressBar() {
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach((step, index) => {
                if (index <= currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const counter = document.getElementById('step-counter');
            
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === consequences[selectedChange.id].length - 1;
            
            counter.textContent = `${currentStep + 1} из ${consequences[selectedChange.id].length}`;
        }

        function nextStep() {
            if (currentStep < consequences[selectedChange.id].length - 1) {
                currentStep++;
                updateStoryContent();
                updateNavigation();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStoryContent();
                updateNavigation();
            }
        }

        function resetGame() {
            selectedChange = null;
            currentStep = 0;
            setIsAnimating(false);
            document.getElementById('story-view').style.display = 'none';
            document.getElementById('main-menu').style.display = 'block';
        }

        function setIsAnimating(value) {
            isAnimating = value;
        }

        function getGradientForColor(color) {
            const gradients = {
                blue: 'linear-gradient(135deg, #3b82f6, #8b5cf6)',
                yellow: 'linear-gradient(135deg, #eab308, #ea580c)',
                purple: 'linear-gradient(135deg, #8b5cf6, #ec4899)',
                cyan: 'linear-gradient(135deg, #06b6d4, #3b82f6)',
                red: 'linear-gradient(135deg, #ef4444, #ec4899)',
                teal: 'linear-gradient(135deg, #14b8a6, #06b6d4)',
                green: 'linear-gradient(135deg, #22c55e, #84cc16)',
                indigo: 'linear-gradient(135deg, #6366f1, #8b5cf6)',
                gray: 'linear-gradient(135deg, #6b7280, #64748b)',
                amber: 'linear-gradient(135deg, #f59e0b, #eab308)'
            };
            return gradients[color] || gradients.blue;
        }

        // Initialize game on load
        initGame();
    </script>
</body>
</html>